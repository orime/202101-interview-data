### ç¬¬ 8 é¢˜ï¼šsetTimeoutã€Promiseã€Async/Await çš„åŒºåˆ«

è§£æï¼š[ç¬¬ 8 é¢˜](https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/33)

è§£ç­”ï¼š

setTimeoutå›è°ƒä¸­çš„å‡½æ•°ä»»åŠ¡ä¸ºå®ä»»åŠ¡ï¼Œä¼šåœ¨åˆ°æœŸæ—¶é—´ä¹‹åï¼Œæ¨å…¥å®ä»»åŠ¡æ‰§è¡Œæ ˆä¸­ï¼Œç­‰å¾…æ‰§è¡Œï¼›

ï¼ˆxï¼‰Promiseæ˜¯å¯ä»¥ç”Ÿæˆå¼‚æ­¥æ‰§è¡Œå‡½æ•°çš„æ„é€ å™¨ï¼ŒPromiseåˆ›å»ºè¿‡ç¨‹ä¸­çš„ä»£ç ä¼šç«‹å³æ‰§è¡Œï¼Œä½†resolveå›è°ƒä¼šæ¨å…¥åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­ç­‰å¾…æ‰§è¡Œï¼›

Async/Awaitçš„åŒºåˆ«ï¼šAsyncæ˜¯ç”¨æ¥ä¿®é¥°å‡½æ•°ï¼Œå°†å‡½æ•°å˜æˆå¼‚æ­¥å‡½æ•°ï¼Œåªæœ‰ç”¨asyncä¿®é¥°çš„å‡½æ•°é‡Œé¢æ‰å¯ä»¥ç”¨awaitæ§åˆ¶å…¶ä»–å¼‚æ­¥è¿‡ç¨‹è°ƒç”¨

```javascript

```

#### æ€»ç»“ï¼š

è¿™é¢˜æ€ä¹ˆæ²¡äººç­”ï¼Œæˆ‘è¯´ä¸‹æˆ‘ç²—æµ…çš„è®¤è¯†ï¼ŒæŠ›ç –å¼•ç‰ï¼Œæ¬¢è¿æŒ‡æ­£å’Œè¡¥å……ã€‚ æˆ‘è§‰å¾—è¿™é¢˜ä¸»è¦æ˜¯è€ƒå¯Ÿè¿™ä¸‰è€…åœ¨äº‹ä»¶å¾ªç¯ä¸­çš„åŒºåˆ«ï¼Œäº‹ä»¶å¾ªç¯ä¸­åˆ†ä¸ºå®ä»»åŠ¡é˜Ÿåˆ—å’Œå¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚ å…¶ä¸­settimeoutçš„å›è°ƒå‡½æ•°æ”¾åˆ°å®ä»»åŠ¡é˜Ÿåˆ—é‡Œï¼Œç­‰åˆ°æ‰§è¡Œæ ˆæ¸…ç©ºä»¥åæ‰§è¡Œï¼› promise.thené‡Œçš„å›è°ƒå‡½æ•°ä¼šæ”¾åˆ°ç›¸åº”å®ä»»åŠ¡çš„å¾®ä»»åŠ¡é˜Ÿåˆ—é‡Œï¼Œç­‰å®ä»»åŠ¡é‡Œé¢çš„åŒæ­¥ä»£ç æ‰§è¡Œå®Œå†æ‰§è¡Œï¼›asyncå‡½æ•°è¡¨ç¤ºå‡½æ•°é‡Œé¢å¯èƒ½ä¼šæœ‰å¼‚æ­¥æ–¹æ³•ï¼Œawaitåé¢è·Ÿä¸€ä¸ªè¡¨è¾¾å¼ï¼Œasyncæ–¹æ³•æ‰§è¡Œæ—¶ï¼Œé‡åˆ°awaitä¼šç«‹å³æ‰§è¡Œè¡¨è¾¾å¼ï¼Œç„¶åæŠŠè¡¨è¾¾å¼åé¢çš„ä»£ç æ”¾åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—é‡Œï¼Œè®©å‡ºæ‰§è¡Œæ ˆè®©åŒæ­¥ä»£ç å…ˆæ‰§è¡Œã€‚

ğŸ‘ 93ğŸ˜„ 7ğŸ‰ 17ğŸ˜• 5â¤ï¸ 13ğŸš€ 17ğŸ‘€ 21

#### æ‰©å±•ï¼š

- å…³äºPromiseçš„æ­£ç¡®è®¤è¯†ï¼šPromiseæœ¬èº«æ˜¯**åŒæ­¥çš„ç«‹å³æ‰§è¡Œå‡½æ•°**ï¼Œ å½“åœ¨executorä¸­æ‰§è¡Œresolveæˆ–è€…rejectçš„æ—¶å€™, æ­¤æ—¶æ˜¯å¼‚æ­¥æ“ä½œï¼Œ ä¼šå…ˆæ‰§è¡Œthen/catchç­‰ï¼Œå½“ä¸»æ ˆå®Œæˆåï¼Œæ‰ä¼šå»è°ƒç”¨resolve/rejectä¸­å­˜æ”¾çš„æ–¹æ³•æ‰§è¡Œã€‚

```js
console.log('script start')
let promise1 = new Promise(function (resolve) {
    console.log('promise1')
    resolve()
    console.log('promise1 end')
}).then(function () {
    console.log('promise2')
})
setTimeout(function(){
    console.log('settimeout')
})
console.log('script end')
// è¾“å‡ºé¡ºåº: script start->promise1->promise1 end->script end->promise2->settimeout
// è¾“å‡ºé¡ºåºï¼šscript start->promise1->promise1 end->script end->promise2->settimeout
```

- async å‡½æ•°è¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼Œå½“å‡½æ•°æ‰§è¡Œçš„æ—¶å€™ï¼Œä¸€æ—¦é‡åˆ° await å°±ä¼šå…ˆè¿”å›ï¼Œç­‰åˆ°è§¦å‘çš„å¼‚æ­¥æ“ä½œå®Œæˆï¼Œå†æ‰§è¡Œå‡½æ•°ä½“å†…åé¢çš„è¯­å¥ã€‚å¯ä»¥ç†è§£ä¸ºï¼Œæ˜¯è®©å‡ºäº†çº¿ç¨‹ï¼Œè·³å‡ºäº† async å‡½æ•°ä½“ã€‚

```js
async function async1(){
   console.log('async1 start');
    await async2();
    console.log('async1 end')
}
async function async2(){
    console.log('async2')
}

console.log('script start');
async1();
console.log('script end')

// è¾“å‡ºé¡ºåºï¼šscript start->async1 start->async2->script end->async1 end
```

- awaitçš„å«ä¹‰ä¸ºç­‰å¾…ï¼Œä¹Ÿå°±æ˜¯ async å‡½æ•°éœ€è¦ç­‰å¾…awaitåçš„å‡½æ•°æ‰§è¡Œå®Œæˆå¹¶ä¸”æœ‰äº†è¿”å›ç»“æœï¼ˆPromiseå¯¹è±¡ï¼‰ä¹‹åï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œä¸‹é¢çš„ä»£ç ã€‚awaité€šè¿‡è¿”å›ä¸€ä¸ªPromiseå¯¹è±¡æ¥å®ç°åŒæ­¥çš„æ•ˆæœã€‚

- æ›´å¤šå¯è§[setTimeoutã€Promiseã€Async/Await](https://github.com/sisterAn/blog/issues/21)

  ğŸ‘ 140ğŸ‘ 1ğŸ˜„ 3ğŸ‰ 13ğŸ˜• 1ğŸš€ 2ğŸ‘€ 11

- å…³äºæ‰§è¡Œæ ˆçš„æ€»ç»“
  - åœ¨æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆçš„åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œåï¼›
  - é¦–å…ˆæ‰§è¡ŒMicrotaské˜Ÿåˆ—ï¼ŒæŒ‰ç…§é˜Ÿåˆ—`å…ˆè¿›å…ˆå‡º`çš„åŸåˆ™ï¼Œä¸€æ¬¡æ‰§è¡Œå®Œæ‰€æœ‰Microtaské˜Ÿåˆ—ä»»åŠ¡ï¼›
  - ç„¶åæ‰§è¡ŒMacrotask/Taské˜Ÿåˆ—ï¼Œä¸€æ¬¡æ‰§è¡Œä¸€ä¸ªï¼Œä¸€ä¸ªæ‰§è¡Œå®Œåï¼Œæ£€æµ‹ Microtaskæ˜¯å¦ä¸ºç©ºï¼›
  - ä¸ºç©ºåˆ™æ‰§è¡Œä¸‹ä¸€ä¸ªMacrotask/Taskï¼›
  - ä¸ä¸ºç©ºåˆ™æ‰§è¡ŒMicrotask



![img](https://user-images.githubusercontent.com/18441915/68822044-d088ad00-06ca-11ea-8570-54a683dfef5d.jpg)